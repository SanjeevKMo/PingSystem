<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Systems - Government Systems Monitor</title>
  <link rel="stylesheet" href="../CSS/design-system.css">
  <link rel="stylesheet" href="../CSS/styles-new.css">
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-logo">
      <div class="header-logo-icon">üõ°Ô∏è</div>
      <span>Government Systems Monitor</span>
    </div>
    <nav class="header-nav">
      <a href="index.html">Dashboard</a>
      <a href="admin-systems.html" class="active">Admin</a>
    </nav>
    <div class="header-actions">
      <span id="user-name" style="color: rgba(255,255,255,0.8); margin-right: var(--space-4);"></span>
      <button class="btn btn-secondary btn-sm" onclick="logout()">Logout</button>
    </div>
  </header>

  <!-- Main Content -->
  <main>
    <div class="container">
      <!-- Page Header -->
      <div class="page-header">
        <h1 class="page-title">System Management</h1>
        <p class="page-subtitle">Manage systems and view detailed information</p>
      </div>

      <!-- Alert Container -->
      <div id="alert" class="alert" style="display: none;"></div>

      <!-- Add System Form Card -->
      <div class="card" style="margin-bottom: var(--space-8);">
        <div class="card-header">
          <div>
            <h3 class="card-title">Add New System</h3>
            <p class="card-subtitle">Add a new system to monitor</p>
          </div>
        </div>

        <div class="card-body">
          <form id="systemForm">
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">System Name *</label>
                <input type="text" class="form-input" name="name" required placeholder="e.g., National ID Portal">
              </div>

              <div class="form-group">
                <label class="form-label">System Type *</label>
                <select class="form-select" name="type" id="systemType" required>
                  <option value="">Select type...</option>
                  <option value="Web Application">Web Application</option>
                  <option value="Database">Database</option>
                  <option value="Server">Server</option>
                  <option value="API">API</option>
                  <option value="Portal">Portal</option>
                  <option value="Service">Service</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label class="form-label">Agency *</label>
                <select class="form-select" name="agency" id="systemAgency" required>
                  <option value="">Select agency...</option>
                  <!-- Populated by JavaScript -->
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Status *</label>
                <select class="form-select" name="status" id="systemStatus" required>
                  <option value="Up">Up</option>
                  <option value="Down">Down</option>
                  <option value="Maintenance">Maintenance</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">URL or Endpoint</label>
              <input type="text" class="form-input" name="url" placeholder="https://example.gov.bt">
              <p class="form-helper">Optional: URL for automated health checks</p>
            </div>

            <div style="display: flex; gap: var(--space-4); justify-content: flex-end;">
              <button type="reset" class="btn btn-secondary">Clear Form</button>
              <button type="submit" class="btn btn-primary">Add System</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Systems Table -->
      <div class="card" style="margin-bottom: var(--space-12);">
        <div class="card-header">
          <div>
            <h3 class="card-title">All Systems</h3>
            <p class="card-subtitle">Manage and monitor all government systems</p>
          </div>
          <div>
            <input 
              type="text" 
              id="search-input" 
              class="form-input" 
              placeholder="Search systems..."
              style="width: 250px; padding: var(--space-2) var(--space-4); font-size: var(--text-sm);"
            >
          </div>
        </div>

        <div id="systemsTable" style="margin-top: var(--space-6);">
          <div class="loading" style="text-align: center; padding: var(--space-8);">
            <div class="loading-spinner" style="margin: 0 auto var(--space-4);"></div>
            <p>Loading systems...</p>
          </div>
        </div>
      </div>

      <!-- Agencies Section -->
      <div style="margin-top: var(--space-12);">
        <div class="page-header">
          <h2 class="page-title" style="font-size: var(--text-3xl); background: none; -webkit-text-fill-color: unset; color: var(--color-text-primary);">Agencies Management</h2>
          <p class="page-subtitle">Create and manage government agencies</p>
        </div>

        <!-- Agency Form Card -->
        <div class="card" style="margin-bottom: var(--space-6);">
          <div class="card-header">
            <div>
              <h3 class="card-title">Add New Agency</h3>
              <p class="card-subtitle">Create a new government agency</p>
            </div>
          </div>

          <div class="card-body">
            <form id="agencyForm">
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Agency Name *</label>
                  <input type="text" class="form-input" name="name" required placeholder="e.g., Ministry of Health">
                </div>

                <div class="form-group">
                  <label class="form-label">Icon Emoji</label>
                  <input type="text" class="form-input" name="icon_emoji" placeholder="üè¢" maxlength="2">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Icon URL (Optional)</label>
                  <input type="text" class="form-input" name="icon_url" placeholder="https://example.com/icon.png">
                </div>

                <div class="form-group">
                  <label class="form-label">Color Code</label>
                  <input type="color" class="form-input" name="color_code" value="#667eea">
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">Contact Email</label>
                  <input type="email" class="form-input" name="contact_email" placeholder="contact@agency.gov.bt">
                </div>

                <div class="form-group">
                  <label class="form-label">Contact Phone</label>
                  <input type="text" class="form-input" name="contact_phone" placeholder="+975-XXXX-XXXX">
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Description</label>
                <textarea class="form-textarea" name="description" rows="3" placeholder="Brief description of the agency"></textarea>
              </div>

              <div style="display: flex; gap: var(--space-4); justify-content: flex-end;">
                <button type="reset" class="btn btn-secondary">Clear Form</button>
                <button type="submit" class="btn btn-primary">Create Agency</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Agencies Table -->
        <div id="agenciesTable">
          <div class="empty-state">
            <div class="loading-spinner"></div>
            <p style="margin-top: var(--space-4);">Loading agencies...</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Edit System Modal -->
  <div class="modal-overlay" id="editModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Edit System</h2>
        <button class="modal-close" onclick="closeEditModal()">‚úï</button>
      </div>

      <div class="modal-body">
        <form id="editForm">
          <input type="hidden" id="editSystemId" name="id">
          
          <div class="form-group">
            <label class="form-label">System Name *</label>
            <input type="text" class="form-input" id="editSystemName" name="name" required>
          </div>

          <div class="form-group">
            <label class="form-label">System Type *</label>
            <select class="form-select" id="editSystemType" name="type" required>
              <option value="">Select type...</option>
              <option value="Web Application">Web Application</option>
              <option value="Database">Database</option>
              <option value="Server">Server</option>
              <option value="API">API</option>
              <option value="Portal">Portal</option>
              <option value="Service">Service</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Agency *</label>
            <select class="form-select" id="editSystemAgency" name="agency" required>
              <option value="">Select agency...</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Status *</label>
            <select class="form-select" id="editSystemStatus" name="status" required>
              <option value="Up">Up</option>
              <option value="Down">Down</option>
              <option value="Maintenance">Maintenance</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">URL or Endpoint</label>
            <input type="text" class="form-input" id="editSystemUrl" name="url">
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
        <button class="btn btn-primary" type="submit" form="editForm">Update System</button>
      </div>
    </div>
  </div>

  <!-- Edit Agency Modal -->
  <div class="modal-overlay" id="editAgencyModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Edit Agency</h2>
        <button class="modal-close" onclick="closeEditAgencyModal()">‚úï</button>
      </div>

      <div class="modal-body">
        <form id="editAgencyForm">
          <input type="hidden" id="editAgencyId" name="id">
          
          <div class="form-group">
            <label class="form-label">Agency Name *</label>
            <input type="text" class="form-input" id="editAgencyName" name="name" required>
          </div>

          <div class="form-group">
            <label class="form-label">Description</label>
            <textarea class="form-textarea" id="editAgencyDescription" name="description" rows="3"></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Agency Icon (Emoji)</label>
              <input type="text" class="form-input" id="editAgencyEmoji" name="icon_emoji" placeholder="üè¢" maxlength="2">
            </div>

            <div class="form-group">
              <label class="form-label">Color Code</label>
              <input type="color" class="form-input" id="editAgencyColor" name="color_code" value="#667eea">
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Icon URL (Optional)</label>
            <input type="text" class="form-input" id="editAgencyIconUrl" name="icon_url" placeholder="https://example.com/icon.png">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Contact Email</label>
              <input type="email" class="form-input" id="editAgencyEmail" name="contact_email">
            </div>

            <div class="form-group">
              <label class="form-label">Contact Phone</label>
              <input type="text" class="form-input" id="editAgencyPhone" name="contact_phone">
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeEditAgencyModal()">Cancel</button>
        <button class="btn btn-primary" type="submit" form="editAgencyForm">Update Agency</button>
      </div>
    </div>
  </div>

  <!-- FIXED: Now using external JavaScript file instead of inline -->
  <script src="../JS/admin-systems.js"></script>
</body>
</html>